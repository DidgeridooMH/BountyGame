trigger: none

jobs:
  - job: windows_build
    pool:
      vmImage: windows-latest
    displayName: Windows Build
    variables: 
      - name: sdk
        value: C:\\VulkanSDK
      - name: sdkSource
        value: https://sdk.lunarg.com/sdk/download/latest/windows/vulkan-sdk.exe
    steps:
      - name: Cache Vulkan SDK
        id: cache-vulkan-sdk
        uses: actions/cache@v1
        with:
          path: ${{ variables.sdk }}
          key: vulkan-sdk
      - name: Setup Vulkan
        if: steps.cache-vulkan-sdk.outputs.cache-hit != 'true'
        run: |
          Invoke-WebRequest -Uri "${{ variables.sdkSource }}" -OutFile VulkanSDK.exe
          $installer = Start-Process -FilePath VulkanSDK.exe -Wait -PassThru -ArgumentList @("/S");
          $installer.WaitForExit();
      - task: MSBuild@1
        env:
          VULKAN_SDK: ${{ variables.sdk }}
        inputs:
          environmentVariables: 
          solution: '**/*.sln'
          msbuildArchitecture: 'x64'
          platform: 'x64'
          configuration: 'Release'
      - task: PublishBuildArtifacts@1
        inputs:
          PathtoPublish: '$(Build.ArtifactStagingDirectory)\x64\Release\'
          ArtifactName: 'otterbuild'
          publishLocation: 'Container'
          StoreAsTar: true